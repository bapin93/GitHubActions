name: action-one
on: [push]
jobs:
  check-bats-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
        with:
          node-version: '14'
      - run: npm install -g bats
      - run: bats -v
  deploy:
    runs-on: ubuntu-latest
    needs: test # this job depends on "test" having finished
    if: github.ref == 'refs/heads/main' # we tell Github to only execute this step if we're on our master branch (so we don't put unfinished branches in production)
    steps:
      - name: Deploy to AWS Ubuntu
        uses: appleboy/ssh-action@master # An action made to control Linux servers
        with: # We set all our secrets here for the action, these won't be shown in the action logs
          host: ${{ secrets.TEST_HOST }}
          username: ${{ secrets.TEST_USERNAME }}
          key: ${{ secrets.TEST_KEY }}
          passphrase: ${{ secrets.TEST_KEY_PASS }}
          script: whoami #|
            #cd <your-app-folder> # we move into our app's folder
            #git pull # we pull any changes from git
            #npm prune # we remove any unused dependencies
            #npm install # we install any missing dependencies
            #npm run build # we build our app
            #pm2 reload all # we reload the app via PM2